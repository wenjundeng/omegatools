#!/bin/bash

# Copyright 2012 Wenjun Deng <wdeng@wdeng.info>

# This file is part of Omega Tools.

# Omega Tools is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# Omega Tools is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with Omega Tools.  If not, see <http://www.gnu.org/licenses/>.

VERSION="2012-04-03 15:18:20-04:00 to update"

if [ -z "${1}" ];
then
	echo
	echo "gpmp2latexmp version ${VERSION}"
	echo
	echo "Process .mp file generated by gnuplot metapost terminal."
	echo "When passing the .mp file processed by this tool to MetaPost,"
	echo "MetaPost will use LaTeX (math mode) to process texts in the figure."
	echo
	echo "Usage: gpmp2latexmp <.mp file generated by gnuplot>"
	echo
	exit
fi
if [ ! -f ${1} ];
then
	echo "File ${1} does not exist."
	exit 1
fi

cp ${1} ${1}~
sed "s/%GNUPLOT Metapost output/%Processed by gpmp2latexmp version ${VERSION}\n%Processed at `date`\nverbatimtex\n%\&latex\n\\\\documentclass{article}\n\\\\usepackage{amsmath}\n\\\\begin{document}\netex\n\n%GNUPLOT Metapost output/
s/btex /btex $/g
s/ etex/$ etex/g
s/addto currentpicture also GPtext shifted (x,y)/addto currentpicture also GPtext shifted (x,y) withcolor currentcolor/g
s/end\./verbatimtex\n\\\\end{document}\netex\nend./" < ${1}~ > ${1}

